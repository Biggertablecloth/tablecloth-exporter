import os
import shutil
import time
from tqdm.auto import tqdm
import selenium
from selenium import webdriver
from selenium import webdriver
from selenium.common.exceptions import TimeoutException
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.common.by import By

driver = webdriver.Chrome()
driver.get("https://login.tablecloth.io/")

username, password = driver.find_elements_by_tag_name('input')
username.send_keys("anushree.chaudhuri@tablecloth.io")
password.send_keys("")

sign_in_button = driver.find_element_by_xpath('/html/body/div[1]/div/div/div/div[2]/button/span[1]').click()


def wait_for_element(xpath):
    try:
        element_present = EC.presence_of_element_located(
            (By.XPATH, xpath))
        WebDriverWait(driver, 60).until(element_present)
        element_present = EC.element_to_be_clickable(
            (By.XPATH, xpath))
        WebDriverWait(driver, 60).until(element_present)

    except TimeoutException:
        print('time out occured')


wait_for_element('/html/body/div[1]/div/header/div/div[2]/button[2]')
driver.find_element_by_xpath('/html/body/div[1]/div/header/div/div[2]/button[2]').click()

time.sleep(10)

dashboard_ids = [
    "658808",
    "658802",
    "658799",
    "658776",
    "658775",
    "658756",
    "658752",
    "658749",
    "658716",
    "658715",
    "658714",
    "658713",
    "658712",
    "658711",
    "658701",
    "658639",
    "658589",
    "658588",
    "658533",
    "658532",
    "658503",
    "658496",
    "658464",
    "658461",
    "658460",
    "658322",
    "658285",
    "658281",
    "658261",
    "657917",
    "657881",
    "657870",
    "657857",
    "657852",
    "657851",
    "657829",
    "657820",
    "657800",
    "657788",
    "657779",
    "657754",
    "657753",
    "657752",
    "657750",
    "657749",
    "657742",
    "657740",
    "657709",
    "657693",
    "657599",
    "657574",
    "657571",
    "657566",
    "657560",
    "657558",
    "657547",
    "657546",
    "657543",
    "657539",
    "657507",
    "657506",
    "657502",
    "657500",
    "657483",
    "657482",
    "657480",
    "657476",
    "657457",
    "657409",
    "657357",
    "657267",
    "657255",
    "657214",
    "657213",
    "657212",
    "657211",
    "657210",
    "657206",
    "657202",
    "657201",
    "657200",
    "657199",
    "657194",
    "657190",
    "657138",
    "657135",
    "657091",
    "657089",
    "657058",
    "657035",
    "657034",
    "657033",
    "657032",
    "657031",
    "656996",
    "656954",
    "656940",
    "656938",
    "656895",
    "656872",
    "656871",
    "656622",
    "656621",
    "656616",
    "656587",
    "656554",
    "656394",
    "656259",
    "656242",
    "656173",
    "656104",
    "656086",
    "656080",
    "656037",
    "656032",
    "656024",
    "655994",
    "655973",
    "655901",
    "655900",
    "655899",
    "655898",
    "655897",
    "655896",
    "655895",
    "655893",
    "655892",
    "655853",
    "655832",
    "655781",
    "655739",
    "655479",
    "655400",
    "655373",
    "655372",
    "655370",
    "655366",
    "655328",
    "655327",
    "655326",
    "655240",
    "655239",
    "655112",
    "655111",
    "655110",
    "655109",
    "655004",
    "654906",
    "654905",
    "654818",
    "654782",
    "654726",
    "654699",
    "654466",
    "654461",
    "654380",
    "654378",
    "654363",
    "654362",
    "654361",
    "654360",
    "654357",
    "654278",
    "654053",
    "654052",
    "654051",
    "654045",
    "654044",
    "654043",
    "654042",
    "654041",
    "653802",
    "653757",
    "653755",
    "653754",
    "653750",
    "653719",
    "653718",
    "653717",
    "653713",
    "653712",
    "653710",
    "653709",
    "653572",
    "653565",
    "653430",
    "653428",
    "653425",
    "653424",
    "653423",
    "653422",
    "653421",
    "653420",
    "653419",
    "653418",
    "653417",
    "653416",
    "653410",
    "653369",
    "653310",
    "653177",
    "653153",
    "653082",
    "653070",
    "652961",
    "652881",
    "652852",
    "652842",
    "652734",
    "652606",
    "652593",
    "652586",
    "652542",
    "652540",
    "652539",
    "652538",
    "652537",
    "652536",
    "652535",
    "652480",
    "652434",
    "652416",
    "652355",
    "652330",
    "652217",
    "652038",
    "652037",
    "652036",
    "651980",
    "651976",
    "651975",
    "651934",
    "651933",
    "651932",
    "651931",
    "651930",
    "651925",
    "651508",
    "651373",
    "651320",
    "651319",
    "651288",
    "651199",
    "651180",
    "651065",
    "651021",
    "650935",
    "650902",
    "650901",
    "650894",
    "650893",
    "650674",
    "650650",
    "650578",
    "650511",
    "650507",
    "650506",
    "650505",
    "650503",
    "650484",
    "650420",
    "650282",
    "650274",
    "650258",
    "650251",
    "650247",
    "650234",
    "650109",
    "649960",
    "649605",
    "649604",
    "649409",
    "649385",
    "649384",
    "649383",
    "649382",
    "649381",
    "649380",
    "649379",
    "649221",
    "649216",
    "649210",
    "649208",
    "649207",
    "649206",
    "648956",
    "648381",
    "648051",
    "648050",
    "648049",
    "648048",
    "648047",
    "648046",
    "647606",
    "647515",
    "647514",
    "647458",
    "647456",
    "647454",
    "647444",
    "647290",
    "647183",
    "646577",
    "646576",
    "646575",
    "646570",
    "646569",
    "646568",
    "646567",
    "646562",
    "646559",
    "646558",
    "646421",
    "645692",
    "645691",
    "645690",
    "645689",
    "645688",
    "645687",
    "645686",
    "645685",
    "645583",
    "645582",
    "645526",
    "645408",
    "645357",
    "645324",
    "645323",
    "645208",
    "645203",
    "645202",
    "644908",
    "644884",
    "644882",
    "644877",
    "644818",
    "644817",
    "644816",
    "644815",
    "644814",
    "644808",
    "644807",
    "644804",
    "644803",
    "644790",
    "644784",
    "644714",
    "644291",
    "644215",
    "644210",
    "644192",
    "644069",
    "644024",
    "643966",
    "643960",
    "643957",
    "643845",
    "643816",
    "643815",
    "643809",
    "643740",
    "643691",
    "643548",
    "643156",
    "643144",
    "642387",
    "642385",
    "642384",
    "642340",
    "642323",
    "641935",
    "641930",
    "641741",
    "641646",
    "641644",
    "641641",
    "641639",
    "641638",
    "641636",
    "641631",
    "641630",
    "641629",
    "641628",
    "641607",
    "641317",
    "641068",
    "641060",
    "640888",
    "640366",
    "640303",
    "639882",
    "639881",
    "639796",
    "639710",
    "638929",
    "638288",
    "638246",
    "638244",
    "638182",
    "638152",
    "637798",
    "637474",
    "637180",
    "637081",
    "636948",
    "636855",
    "636842",
    "636795",
    "636794",
    "636793",
    "636181",
    "636082",
    "636015",
    "635675",
    "635493",
    "635485",
    "635311",
    "635130",
    "635013",
    "634940",
    "634939",
    "634398",
    "634134",
    "634075",
    "633994",
    "633993",
    "633989",
    "633984",
    "633982",
    "633981",
    "633980",
    "633978",
    "633977",
    "633973",
    "633900",
    "633899",
    "633898",
    "633897",
    "633896",
    "633895",
    "633894",
    "633893",
    "633892",
    "633669",
    "633668",
    "633667",
    "633666",
    "633665",
    "633664",
    "633663",
    "633662",
    "633661",
    "633660",
    "633658",
    "633650",
    "633648",
    "633647",
    "633645",
    "633644",
    "633642",
    "633641",
    "633640",
    "633604",
    "633603",
    "633601",
    "633562",
    "633500",
    "633499",
    "633470",
    "633469",
    "633455",
    "633454",
    "633414",
    "633156",
    "633083",
    "633082",
    "633080",
    "633075",
    "632953",
    "632952",
    "632951",
    "632950",
    "632949",
    "632948",
    "632947",
    "632946",
    "632941",
    "632938",
    "632929",
    "632915",
    "632914",
    "632808",
    "632806",
    "632165",
    "631933",
    "631932",
    "631931",
    "631930",
    "631928",
    "631927",
    "631924",
    "631923",
    "631922",
    "631921",
    "631920",
    "631919",
    "631918",
    "631916",
    "631904",
    "631888",
    "631834",
    "631554",
    "631552",
    "630697",
    "630696",
    "630695",
    "630694",
    "630691",
    "630689",
    "630529",
    "630528",
    "630527",
    "630526",
    "630525",
    "630524",
    "630398",
    "630333",
    "630332",
    "630136",
    "630037",
    "629950",
    "629946",
    "629945",
    "629279",
    "629278",
    "629262",
    "629261",
    "629259",
    "629248",
    "629247",
    "629246",
    "629245",
    "627535",
    "627449",
    "627446",
    "627444",
    "627443",
    "627439",
    "627438",
    "627437",
    "627435",
    "627434",
    "627433",
    "627380",
    "627192",
    "626523",
    "626520",
    "626399",
    "626394",
    "626391",
    "626390",
    "626389",
    "626388",
    "626387",
    "626386",
    "626385",
    "626207",
    "626206",
    "626093",
    "625336",
    "625335",
    "625181",
    "624448",
    "623912",
    "623911",
    "623895",
    "623820",
    "623648",
    "623645",
    "623632",
    "623508",
    "623427",
    "622961",
    "622938",
    "622872",
    "622868",
    "622737",
    "622538",
    "622537",
    "622531",
    "622530",
    "622027",
    "621943",
    "621452",
    "621386",
    "621353",
    "621329",
    "621328",
    "621327",
    "621326",
    "621325",
    "621324",
    "621021",
    "620901",
    "620887",
    "620050",
    "620041",
    "620040",
    "620039",
    "620038",
    "620035",
    "620033",
    "620032",
    "620031",
    "620029",
    "620028",
    "620026",
    "620024",
    "619720",
    "619718",
    "619714",
    "619711",
    "619710",
    "619704",
    "619702",
    "619701",
    "619700",
    "619699",
    "619698",
    "619697",
    "619696",
    "619695",
    "619694",
    "619693",
    "619687",
    "619684",
    "619188",
    "618804",
    "618708",
    "618070",
    "618063",
    "617831",
    "617173",
    "616956",
    "616802",
    "616774",
    "616752",
    "616536",
    "616534",
    "615455",
    "615447",
    "614988",
    "613801",
    "613481",
    "613476",
    "613322",
    "613097",
    "612860",
    "612859",
    "612858",
    "612851",
    "612849",
    "612526",
    "612508",
    "612078",
    "611854",
    "611852",
    "611839",
    "611797",
    "611795",
    "611769",
    "611637",
    "611622",
    "611342",
    "611013",
    "610841",
    "610433",
    "610427",
    "610338",
    "609945",
    "609049",
    "608146",
    "608099",
    "608098",
    "607631",
    "607630",
    "607548",
    "607075",
    "606801",
    "606800",
    "606799",
    "606363",
    "605876",
    "605863",
    "605385",
    "605307",
    "605303",
    "605299",
    "605217",
    "605109",
    "605079",
    "605077",
    "605069",
    "604923",
    "604920",
    "604865",
    "604861",
    "604858",
    "604855",
    "604852",
    "604847",
    "602906",
    "602889",
    "602393",
    "602237",
    "602116",
    "601766",
    "600620",
    "600510",
    "600508",
    "600418",
    "600000",
    "599183",
    "599181",
    "598691",
    "598391",
    "598361",
    "598178",
    "598177",
    "597172",
    "597152",
    "597148",
    "596606",
    "595992",
    "595990",
    "595967",
    "595966",
    "595965",
    "595964",
    "595963",
    "595832",
    "595831",
    "595830",
    "595829",
    "595818",
    "595743",
    "595740",
    "595289",
    "595287",
    "594825",
    "594824",
    "594823",
    "594822",
    "594821",
    "594777",
    "594033",
    "593017",
    "593016",
    "593014",
    "593013",
    "592345",
    "591933",
    "591324",
    "591323",
    "591322",
    "591315",
    "591211",
    "591030",
    "590931",
    "590819",
    "590796",
    "590795",
    "590428",
    "590427",
    "590425",
    "590422",
    "590013",
    "589997",
    "589714",
    "589274",
    "589270",
    "589261",
    "589090",
    "588912",
    "588911",
    "588908",
    "588863",
    "588862",
    "588056",
    "587918",
    "587554",
    "587414",
    "586216",
    "586212",
    "584674",
    "584451",
    "584441",
    "584439",
    "584438",
    "584429",
    "584419",
    "584417",
    "584415",
    "584407",
    "583239",
    "581566",
    "581564",
    "581563",
    "581536",
    "580350",
    "580188",
    "579923",
    "578480",
    "578310",
    "577758",
    "577757",
    "577272",
    "575007",
    "574996",
    "574538",
    "574373",
    "574357",
    "570929",
    "570928",
    "570927",
    "569783",
    "569087",
    "569086",
    "569085",
    "568568",
    "568430",
    "567463",
    "566678",
    "566677",
    "566676",
    "566675",
    "566674",
    "566673",
    "566662",
    "566475",
    "564967",
    "564926",
    "564153",
    "564123",
    "563834",
    "563138",
    "562963",
    "561956",
    "560995",
    "560005",
    "559700",
    "557777",
    "557767",
    "556233",
    "549980",
    "548887",
    "548883",
    "548882",
    "545952",
    "541933",
    "541182",
    "541161",
    "536729",
]

for dashboard_id in tqdm(dashboard_ids, desc='Progress'):
    while True:
        try:
            if os.path.exists(os.path.join(r'G:\Shared drives\Data\Dashboard Backup', dashboard_id + '.pdf')):
                break

            driver.get(f'https://data.tablecloth.io/infographics/{dashboard_id}')
            print(driver.title)
            time.sleep(4)
            driver.find_element_by_class_name("designer-box__more-button").click()
            time.sleep(4)
            driver.find_element_by_xpath("//*[contains(text(), 'Share & export')]").click()
            time.sleep(4)
            driver.find_element_by_xpath("//*[contains(text(), 'Download PDF')]").click()
            time.sleep(15)

            title = driver.title.replace(' - The Data Center', '').replace('/', '_')

            shutil.move(os.path.join(r'C:\Users\anush\Downloads', title + '.pdf'),
                        os.path.join(r'G:\Shared drives\Data\Dashboard Backup', dashboard_id + '.pdf'))
            break
        except:
            print('Skipped a dashboard due to an error. Trying again...')
    # driver.find_element_by_partial_link_text('Share & export').click()
    # driver.find_element_by_id('c__id11496').click()
